package Interviews.imdb;

import java.util.Iterator;
import java.util.LinkedList;

/**
 * . Write code in a language of your choice to find the longest 
 *   monotonically increasing contiguous subsequence in a sequence
 *   of integers and reverse it. (750 character max)
 * @author Max
 *
 */
public class Solution {
	
	final LinkedList<Integer> list;
	LinkedList<Integer> sub;
	final int listSize;
	int maxLength = 0;  int smallest;
	
	public Solution(int[] sequence) {
		list = new LinkedList<Integer>();
		listSize = sequence.length;
		for (int i : sequence) 
			list.addLast(i);
		System.out.println("\narrLen: "+sequence.length + ", list: " + list.size());//+ ", mapLen: " + llist.size() + "\n");
	}
	
	
	public int[] getSolution() {
		int[] sequence = new int[length()];
		Iterator<Integer> rev = sub.descendingIterator();
		int i = 0;
		while (rev.hasNext())
			sequence[i++] = rev.next();
		return sequence;
	}
	
	int length() {
		return getSub(0);
	}
	private int getSub(int start) {
		Iterator<Integer> i = this.list.listIterator(start);
		print(i);
		int first = i.next();
		if (start != 0 && first >= smallest) {
			if (listSize - start > maxLength)
				return getSub(++start);	
			else
				return maxLength;
		} else {
			smallest = first;
		}
		
		LinkedList<Integer> sub = new LinkedList<Integer>();
		sub.addLast(first);
		while (i.hasNext()) {
			int next = i.next();
			if (next > sub.getLast())
				sub.add(next);
		}
		print(sub);
		int size = sub.size();
		if (size > maxLength) {
			
			maxLength = size;
			this.sub = sub;
		}

		if (listSize - start > maxLength) //Can we still find a longer sequence
			return getSub(++start);	
		else
			return  maxLength;
	}
	
	public static void main(String[]args) {
		int[] a = {3, 8,2,3, 4, 12, 2, 10, 6, 14, 1, 9, 5, 13, 3, 11, 7, 15};
		int[] s = new Solution(a).getSolution();
		System.out.print("Solution: ");
		print(s);
		
	}
	
	static <T> void print(LinkedList<T> o) {
		Iterator<T> i = o.iterator();
		print(i);
	}
	
	static <T>void print(Iterator<T> i) {
		System.out.print("[ " + i.next());
		while (i.hasNext())
			System.out.print(", " + i.next());
		System.out.print(" ]\n");
	}
	
	static void print(int[] o) {
		System.out.print("[ " + o[0]);
		for (int i = 1;i<o.length;++i)
			System.out.print(", " + o[i]);
		System.out.print(" ]\n");
	}
	
}
